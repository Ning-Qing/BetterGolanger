## 进程

* 进程是程序在一个数据集合上的运行过程，是系统进行资源分配和调度的一个基本单位
* 进程是可并发执行的程序在一个数据集合上的运行过程 

> 特点

* 动态性
* 并发性
* 独立性
* 异步性

> 结构

* 程序（Programs）
* 数据（Datas）
* PCB



## 进程的状态

> 挂起状态

* 处理器速度远远快于io，可能存在所有进程都在等待io
* 将进程交换到磁盘上，换出内存空间
* 如果阻塞进程交换到磁盘上，会变成挂起状态




> 导致挂起的原因

* 周期性运行的进程
* 交出的用户请求
* 父进程请求挂起子进程



> 被挂起进程的特征

* 不能立即执行

* 可能是等待某事件发送。若是，测则阻塞条件独立于挂载条件，即使阻塞事件法神，更改进程也不能执行。（阻塞解除了、但挂起没解决。使用还是不能工作）

* 使之挂起的进程为：① 自身 ②其父进程 ③ OS
* 只有挂起它的进程才能使之由挂起状态转换为其他状态（解铃还须系铃人）


> 区分阻塞和挂起

* 阻塞与否---》 进程是否等待事件
* 挂起与否---》 进程是否被换出内存

四种组合

Ready：内存、准备

Blocked：内存、等待

Ready，Suspend： 外存、需调入即可执行

Blocked，Suspend： 外存，等待事件



> 七状态

![image-20210920213213390](/Users/weixizi/Library/Application Support/typora-user-images/image-20210920213213390.png)

进程挂载是挂进程自身用户的数据和程序

PCB加载信息（状态、堆栈信息）

![image-20210920214547850](/Users/weixizi/Library/Application Support/typora-user-images/image-20210920214547850.png)

![image-20210920214614652](/Users/weixizi/Library/Application Support/typora-user-images/image-20210920214614652.png)



## 进程的描述与结构

操作系统需要记载当前进程和资源的当前状态



> 内存表

* 记载内存分配情况

* 记载外存分配情况

* 记录进程对共享区操作的权限
* 管理虚拟存储信息



> 设备表

* 设置状态（空闲可用、以分配）
* IO状态信息
* IO传输原和目的地



> 进程表

* 进程位置
  * 进程包含一组程序（局部和全局变量、定义的常数、堆栈信息、PCB） `总和就是进程映像`

* 管理进程属性
  * 进程id
  * 进程状态
  * 内存的位置

PCB是感知进程控制进程的基本结构



> PCB

* 进程标识
  * 进程id（父进程id、用户id）
* 进程状态信息
  * 控制寄存器
  * 条件寄存器
* 堆栈信息
* 进程状态。优先级
* 进程的关系
* 进程之间的通信
* 内存划分信息

![image-20210920230615511](/Users/weixizi/Library/Application Support/typora-user-images/image-20210920230615511.png)



## 操作系统内核管理功能

* 进程管理： 进程的创建和终止、调度、状态转换、同步和通信、管理PCB 

* 内存管理： 为进程分配地址空间、对换、段/页管理
* 设备管理： 缓存管理、为进程分配I/O通道和设备
* 支撑功能：中断管理、时钟管理、原语、统计资源使用情况



## 什么时候会切换进程

* 时间中断： 时间片到
* IO中断
* 存储访问失效（主要是虚拟存储）
* 陷阱（可能会退出）
* 管理程序调入



## 进程中断过程

1. 保存现场
2. 更新PCB
3. 移动PCB到响应队列
4. 选着另一个程序执行
5. 更新选着进程的PCB
6. 修改内存管理结构
7. 恢复被选着程序的现场



## 进程切换和模式切换

进程切换：是作用与进程之间的一种操作。当分派程序收回当前线程的CPU并准备把它分配给某个就绪程序时，该操作将被引用。

模式切换：是进程内部所引用的一种操作。当进程映像所包含的程序引用内核子系统所提供的系统调用时，该操作将被引用。



## 原语

##### 1)操作系统最底层，最接近硬件的部分

##### 2)程序运行原子性，其操作一气呵成（系统安全，便于管理）

##### 3)运行时间较短，调用频繁

**定义原语的直接方法，关闭中断，让其所有动作不可分割地完成后再打开中断**



![6D0114F7-1C20-4CA8-8C96-865380DECA45](/Users/weixizi/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/495297423/QQ/Temp.db/6D0114F7-1C20-4CA8-8C96-865380DECA45.png)

![image-20210921133735974](/Users/weixizi/Library/Application Support/typora-user-images/image-20210921133735974.png)
