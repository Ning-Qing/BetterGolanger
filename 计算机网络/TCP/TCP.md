# 三、传输层（一）

## 3.1 概述和传输层服务

传输服务和协议

* 为运行在不同主机上的应用进程提供逻辑通信
* 传输协议运行在端系统
  * 发送方：将应用层的报文分成报文段，然后传递给网络层
  * 接收方：将报文段重组成报文，然后传递给应用层
* 有多个传输层协议可供应用选择
  * Internet: `TCP`(字节流的服务，不保证界限) 和`UDP`

> 传输层

提供主机之间的逻辑通信

> 网络层

进程之间的逻辑通信。

依赖于网络层服务`延时、带宽且无法增强`

对网络层的服务进行增强。`数据丢失、顺序混乱、加密`

> Internet传输层协议

| TCP(字节流的服务)            | UDP(数据包的服务)                            |
| ---------------------------- | -------------------------------------------- |
| 可靠的、保序的传输           | 不可靠、不保序的传输                         |
| 多路复用、解复用             | 多路复用、解复用                             |
| 拥塞控制、流量控制、建立连接 | 没有为尽力而为的IP服务添加更多的其它额外服务 |



## 3.2 多路复用

多路复用/解复用（一个TCP/UDP实体上有很多应用进程借助其发送）

> 在发送方主机多路复用

	从多个套接字接收来自多个进程的报文，**根据套接字对应的IP地址和端口号**等信息对报文段用头部加以封装 (该头部信息用于以后的**解复用**)

>  在接收方多路解复用

	根据报文段的头部信息中的**IP地址和端口号将接收到的报文段发给正确的套接字**(和对应的应用进程)

> 多路复用工作原理

* 解复用作用：TCP或者UDP实体采 用哪些信息，将报文段的数据部分 交给正确的socket，从而交给正确的进程
* 主机收到IP数据报

  * 每个数据报有源IP地址和目标地址

  * 每个数据报承载一个传输层报文段

  * 每个报文段有一个源端口号和目标端口号 (特定应用有著名的端口号)
* 主机联合使用IP地址和端口号将报文段发送给合适的套接字

> 无连接(UDP)多路解复用

当创建UDP段采用端口号，可以指定： `目标IP地址、目标端口号`
当主机接收到UDP段时： • 检查UDP段中的目标端 口号 • 将UDP段交给具备那个端口号的套接字**目标IP地址，目标端口号一样发送给同一个进程**

![image-20210725125946183](https://img-blog.csdnimg.cn/img_convert/0e8cf8c8bfdfab5f429b903cdb0169b2.png)

>  面向连接(TCP)的多路复用

TCP套接字:四元组本 地标识： `源IP地址、源端口号、目的IP地址、目的端口号`
解复用：接收主机用 这四个值来将数据报 定位到合适的套接字socket 和message

![image-20210725125934798](https://img-blog.csdnimg.cn/img_convert/80fd5e906dc07793ee2dd436cd9825f8.png)